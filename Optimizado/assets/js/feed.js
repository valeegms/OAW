window.addEventListener("DOMContentLoaded",()=>{let a=document.getElementById("all");a.onclick=()=>{b.classList.add("inactive");a.classList.remove("inactive");document.getElementById("sorting-options").style.display="revert";load_news("all")};let b=document.getElementById("categories");b.onclick=()=>{a.classList.add("inactive");b.classList.remove("inactive");document.getElementById("sorting-options").style.display="none";load_categories()};let c=$("sort-by");c.onchange=()=>{load_news_by_order(c.value)};
load_sidebar();load_news("all")});function $(a){return document.getElementById(a)}
function load_news_by_order(a){let b=new XMLHttpRequest;b.onload=function(){if(4===this.readyState&&200===this.status){document.getElementById("news").innerHTML=this.response;let c=document.getElementById("refresh");c.style.cursor="pointer";c.onclick=d=>{d.stopImmediatePropagation();refresh_all_news("all")}}};show_loader();b.open("POST","assets/php/get_news_by_order.php");b.setRequestHeader("Content-Type","text/plain");b.send(a)}
function load_news_by_category(a){let b=new XMLHttpRequest;b.onload=function(){if(4===this.readyState&&200===this.status){document.getElementById("news").innerHTML=this.response;let c=document.getElementById("refresh");c.style.cursor="pointer";c.onclick=d=>{d.stopImmediatePropagation();load_categories()}}};show_loader();b.open("POST","assets/php/get_news_by_category.php");b.setRequestHeader("Content-Type","text/plain");b.send(a)}
function load_categories(){let a=new XMLHttpRequest;a.onreadystatechange=()=>{if(4===a.readyState&&200===a.status){document.getElementById("news").innerHTML=a.response;for(let c of document.getElementsByClassName("categoria-label"))c.style.cursor="pointer",c.onclick=()=>{load_news_by_category(c.innerText)}}};a.open("POST","assets/php/get_categories.php");a.send();let b=document.getElementById("refresh");b.style.cursor="pointer";b.onclick=c=>{c.stopImmediatePropagation();load_categories()}}
function refresh_all_news(a){let b,c=new XMLHttpRequest,d=[];c.onreadystatechange=()=>{if(c.readyState===XMLHttpRequest.DONE){b=JSON.parse(c.responseText);for(let f=0;f<b.length;f++)d.push(b[f].feed_url);d=d.join(",");let e=new XMLHttpRequest;e.onreadystatechange=()=>{e.readyState===XMLHttpRequest.DONE&&load_news(a)};e.open("POST","assets/php/refresh_all_news.php");e.setRequestHeader("Content-Type","text/plain");e.send(d)}};show_loader();c.open("GET","assets/php/read_db.php");c.send()}
function refresh_news(a){if("all"===a)refresh_all_news(a);else{let b=new XMLHttpRequest;b.onload=function(){4===this.readyState&&200===this.status&&load_news(a)};show_loader();b.open("POST","assets/php/refresh_news.php");b.setRequestHeader("Content-Type","text/plain");b.send(a)}}
function load_news(a){let b=new XMLHttpRequest;b.onload=function(){if(4===this.readyState&&200===this.status){document.getElementById("news").innerHTML=this.response;let c=document.getElementById("refresh");c.style.cursor="pointer";c.onclick=d=>{d.stopImmediatePropagation();refresh_news(a)}}};show_loader();b.open("POST","assets/php/get_news.php");b.setRequestHeader("Content-Type","text/plain");b.send(a)}
function load_sidebar(){let a,b=new XMLHttpRequest;b.onreadystatechange=()=>{if(b.readyState===XMLHttpRequest.DONE){a=JSON.parse(b.responseText);let c=document.getElementById("source-container");c.innerHTML="";for(let d=0;d<a.length;d++)c.innerHTML+=sidebar_format(a[d].feed_url)}};b.open("GET","assets/php/read_db.php");b.send()}function get_url(a){a=new URL(a);return a=a.hostname.replace("www.","")}
function delete_feed(a){let b=new XMLHttpRequest;b.onload=function(){4===this.readyState&&200===this.status&&load_sidebar()};b.open("GET","assets/php/delete_feed.php?url="+a);b.send()}
function sidebar_format(a){let b="delete_feed('"+a+"')",c;c='<div class="d-flex align-items-center justify-content-between py-2"><div class="feed-source rounded-5 w-75 d-flex align-items-center justify-content-center m-0" onclick="(load_news(\''+(a+'\'))"><img src="http://www.google.com/s2/favicons?domain=')+(get_url(a)+'" alt="">');c+="<p>"+get_url(a)+"</p>";return c=c+'</div><div id="delete" class="bg-delete" onclick="('+(b+')"></div></div>')}
function show_loader(){var a=$("refresh");a.onclick=null;a.style.cursor="wait";a=document.getElementById("news");a.innerHTML="<img class='img-fluid p-4' src='assets/icons/loading.gif' alt='Loading' width='200px' height='200px'>";a.innerHTML+="<h2 class ='p-4'>Cargando noticias</h2>"};
